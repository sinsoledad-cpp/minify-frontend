# minify-frontend 功能清单 (Vue 3 + TS + Element Plus)

本项目是对 `minify` Go 后端微服务 () 的前端实现。

## 1. 核心架构 (Core Infrastructure)

这些是支撑整个应用的基础设置。

- [ ] **全局依赖配置 (`main.ts`)**
    - [x] 安装 `vue-router` 并注册 (已由 `create-vue` 完成)
    - [x] 安装 `pinia` 并注册 (已由 `create-vue` 完成)
    - [ ] 全局引入 `Element Plus` (CSS 样式和组件)
    - [ ] 引入 `Element Plus` 图标库
- [ ] **HTTP 请求服务 (`src/services/api.ts`)**
    - [ ] 封装 `axios` 实例，设置 `baseURL`
    - [ ] **请求拦截器：** 自动从 `Pinia` 中读取 `token`，并将其添加到 `Authorization: Bearer <token>` 请求头中。
    - [ ] **响应拦截器：** 统一处理后端返回的错误格式 (`Body{code, msg, data}`)。
        - [ ] `code != 0`: 使用 `ElMessage` 弹出错误 `msg`。
        - [ ] `code == 10005` (Token 无效) 或 `11001`: 强制清除 `Pinia` 状态并跳转到登录页。
- [ ] **状态管理 (`src/stores/user.ts`)**
    - [ ] 创建 `useUserStore` (替换掉 `counter.ts`)。
    - [ ] **State：** `token: string | null`, `username: string`, `role: string`。
    - [ ] **Getters：** `isLoggedIn: boolean`, `isAdmin: boolean`。
    - [ ] **Actions：** `login(token, user)`, `logout()`。
    - [ ] 配置 `pinia-plugin-persistedstate` (可选，推荐) 使 `token` 和 `role` 在刷新后不丢失。
- [ ] **路由守卫 (`src/router/index.ts`)**
    - [ ] **全局前置守卫 (`beforeEach`)：**
        - [ ] 检查 `Pinia` 中是否 `isLoggedIn`。
        - [ ] **白名单：** 如果目标是 `/login` 或 `/register`，直接放行。
        - [ ] **身份验证：** 如果目标 *不是* 白名单，且用户 *未登录*，强制重定向到 `/login`。
        - [ ] **Admin 鉴权：** 如果目标路径以 `/admin` 开头，且 `Pinia` 中的 `role` *不是* `"admin"`，重定向到 `/dashboard` (普通用户首页)。

## 2. 布局与公共页面 (Layout & Public Pages)

- [ ] **根组件 (`App.vue`)**
    - [ ] 清空模板，只保留 `<RouterView />`，让路由来接管整个页面。
- [ ] **登录/注册页 (`src/views/LoginView.vue`)**
    - [ ] 布局：页面居中
    - [ ] 使用 `ElForm` 创建登录和注册的表单 (使用 `ElTabs` 切换)。
    - [ ] **登录逻辑：**
        - [ ] 调用 `POST /api/v1/user/login` 接口。
        - [ ] 成功后，调用 `Pinia` 的 `login` Action 存储 Token 和用户信息，并跳转到 `/dashboard`。
    - [ ] **注册逻辑：**
        - [ ] 调用 `POST /api/v1/user/register` 接口。
        - [ ] 成功后，自动执行登录逻辑。
- [ ] **主布局 (`src/layouts/MainLayout.vue`)**
    - [ ] 使用 `ElContainer` 构建 "上/左/右" 经典后台布局。
    - [ ] **顶部 (`ElHeader`)：**
        - [ ] 显示 Logo。
        - [ ] 右侧显示 `欢迎, {username}`。
        - [ ] 登出按钮（调用 `POST /api/v1/user/logout` 和 `Pinia` 的 `logout` Action）。
    - [ ] **侧边栏 (`ElAside`)：**
        - [ ] 使用 `ElMenu` 构建导航菜单。
        - [ ] **(关键)** 菜单项根据 `Pinia` 中的 `isAdmin` Getter 动态显示（`v-if="store.isAdmin"`）。
- [ ] **404 页面 (`src/views/NotFoundView.vue`)**
    - [ ] 当路由不匹配时显示。

## 3. "User" 角色功能 (Standard User Routes)

(所有页面都嵌套在 `MainLayout.vue` 中)

- [ ] **用户仪表盘 (`src/views/user/DashboardView.vue`)**
    - [ ] **API：** `GET /api/v1/analytics/dashboard`。
    - [ ] 使用 `ElStatistic` 组件显示 `totalLinks`, `totalClicks`。
    - [ ] 显示 `topLink`（最热链接）。
- [ ] **我的链接 (`src/views/user/LinksView.vue`)**
    - [ ] **创建链接：**
        - [ ] 一个 `ElButton` ("创建链接")。
        - [ ] 点击后弹出 `ElDialog` (对话框)，内含 `ElForm`。
        - [ ] 表单包含 `originalUrl`, `customCode`, `expiresIn` 字段。
        - [ ] **API：** `POST /api/v1/links`。
    - [ ] **链接列表：**
        - [ ] **API：** `GET /api/v1/links`，支持分页和状态筛选。
        - [ ] 使用 `ElForm` (inline 模式) 作为筛选器（`status` 下拉框）。
        - [ ] 使用 `ElTable` 显示数据 (`shortCode`, `originalUrl`, `isActive`, `expirationTime`, `createdAt`)。
        - [ ] 操作列：包含 "详情" (跳转)、"编辑"、"删除" 按钮。
    - [ ] **编辑/删除：**
        - [ ] "编辑" 弹出 `ElDialog`，调用 `PUT /api/v1/links/:code`。
        - [ ] "删除" 弹出 `ElMessageBox` (确认框)，调用 `DELETE /api/v1/links/:code`。
- [ ] **链接详情 (`src/views/user/AnalyticsView.vue`)**
    - [ ] **路由：** `/analytics/:code`
    - [ ] **API：** `GET /api/v1/analytics/:code`，支持 `startDate` / `endDate` 筛选。
    - [ ] 使用 `ElDatePicker` (日期范围选择器) 刷新数据。
    - [ ] **图表：**
        - [ ] 引入 `ECharts` (或 `Chart.js`)。
        - [ ] `TimeSeries` -> 渲染为折线图。
        - [ ] `TopReferers`, `TopCountries`, `TopBrowsers` -> 渲染为饼图或柱状图。

## 4. "Admin" 角色功能 (Admin Routes)

(所有页面都嵌套在 `MainLayout.vue` 中，且仅当 `isAdmin` 为 `true` 时才在侧边栏显示)

- [ ] **全站仪表盘 (`src/views/admin/GlobalDashboardView.vue`)**
    - [ ] **API：** `GET /api/v1/admin/analytics/dashboard` (你规划的 admin 接口)。
    - [ ] 界面类似用户仪表盘，但显示的是全站数据。
- [ ] **用户管理 (`src/views/admin/UserManagementView.vue`)**
    - [ ] **API：** `GET /api/v1/admin/users`，支持分页。
    - [ ] 使用 `ElTable` 显示 `id`, `username`, `email`, `role`, `created_at`。
    - [ ] **(拓展功能)** 操作列：
        - [ ] "修改角色" (调用 `PUT /api/v1/admin/users/:id/role`)。
        - [ ] "禁用/启用" (调用 `PUT /api/v1/admin/users/:id/status`)。
- [ ] **全站链接管理 (`src/views/admin/LinkManagementView.vue`)**
    - [ ] **API：** `GET /api/v1/admin/links` (你已实现的 `getLinkAnalyticsAdmin` [sic: `listAllLinks`] 逻辑)。
    - [ ] 界面类似 "我的链接"，但**增加**一个 `userId` 筛选框。
    - [ ] 操作列：包含 "查看详情" (跳转)、"强制禁用"、"强制删除" 按钮。
- [ ] **任意链接详情 (`src/views/admin/GlobalAnalyticsView.vue`)**
    - [ ] **路由：** `/admin/analytics/:code`
    - [ ] **API：** `GET /api/v1/admin/analytics/:code` (你已实现的 `getLinkAnalyticsAdmin` 逻辑)。
    - [ ] 界面与 `AnalyticsView.vue` 完全相同。